<form class="layui-form" lay-filter="form">
    <div class="layui-form-item">
        <label class="layui-form-label required">用户名</label>
        <div class="layui-input-block">
            <input type="text" name="row[username]" value="{$row.username}" lay-verify="required" placeholder="请输入用户名" class="layui-input">
        </div>
    </div>
    
    <div class="layui-form-item">
        <label class="layui-form-label">密码</label>
        <div class="layui-input-block">
            <input type="password" name="row[password]" placeholder="不修改请留空" class="layui-input">
        </div>
    </div>
    
    <div class="layui-form-item">
        <label class="layui-form-label">昵称</label>
        <div class="layui-input-block">
            <input type="text" name="row[nickname]" value="{$row.nickname}" placeholder="请输入昵称" class="layui-input">
        </div>
    </div>
    
    <div class="layui-form-item">
        <label class="layui-form-label">头像</label>
        <div class="layui-input-block">
            <div class="layui-upload">
                <button type="button" class="layui-btn layui-btn-sm" id="uploadAvatar">
                    <i class="layui-icon">&#xe67c;</i>上传头像
                </button>
                <div class="layui-upload-list" style="margin-top: 10px;">
                    <img id="avatarPreview" src="{$row.avatar}" style="max-width: 100px; max-height: 100px; border-radius: 50%; display: {$row.avatar ? 'block' : 'none'};">
                </div>
            </div>
            <input type="hidden" name="row[avatar]" id="avatarInput" value="{$row.avatar}">
            <div class="layui-form-mid layui-word-aux">支持 jpg、png、gif 格式，建议尺寸 200x200</div>
        </div>
    </div>
    
    <div class="layui-form-item">
        <label class="layui-form-label">邮箱</label>
        <div class="layui-input-block">
            <input type="email" name="row[email]" value="{$row.email}" placeholder="请输入邮箱" class="layui-input">
        </div>
    </div>
    
    <div class="layui-form-item">
        <label class="layui-form-label">手机号</label>
        <div class="layui-input-block">
            <input type="text" name="row[mobile]" value="{$row.mobile}" placeholder="请输入手机号" class="layui-input">
        </div>
    </div>
    
    <div class="layui-form-item">
        <label class="layui-form-label">状态</label>
        <div class="layui-input-block">
            <input type="radio" name="row[status]" value="1" title="正常" {$row.status==1?'checked':''}>
            <input type="radio" name="row[status]" value="0" title="禁用" {$row.status==0?'checked':''}>
        </div>
    </div>
    
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="submit">提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>

<script>
layui.use(['form', 'layer', 'upload'], function(){
    var form = layui.form;
    var layer = layui.layer;
    var upload = layui.upload;
    var $ = layui.$;
    
    // 头像上传
    upload.render({
        elem: '#uploadAvatar',
        url: '{$adminUploadUrl|default="/admin/ajax/upload"}',
        accept: 'images',
        acceptMime: 'image/*',
        size: 2048, // 2MB
        before: function(obj){
            layer.load(1);
        },
        done: function(res){
            layer.closeAll('loading');
            if(res.code == 1){
                var avatarUrl = res.data.url;
                $('#avatarInput').val(avatarUrl);
                $('#avatarPreview').attr('src', avatarUrl).show();
                layer.msg('上传成功', {icon: 1});
            } else {
                layer.msg(res.msg || '上传失败', {icon: 2});
            }
        },
        error: function(){
            layer.closeAll('loading');
            layer.msg('上传失败', {icon: 2});
        }
    });
    
    // 监听提交
    form.on('submit(submit)', function(data){
        $.post('{:url("edit")}?id={$row.id}', data.field, function(res){
            if(res.code == 1){
                layer.msg(res.msg, {icon: 1}, function(){
                    parent.layer.closeAll();
                });
            } else {
                layer.msg(res.msg, {icon: 2});
            }
        });
        return false;
    });
});
</script>
