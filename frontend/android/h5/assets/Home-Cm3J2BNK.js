import{_ as T,u as $,r as u,c as L,o as N,a as h,b as m,d as E,e as C,f as H,w as I,g as x,h as K,n as j,s as v,i as g,F as q,j as F,k as U,l as A,m as D}from"./index-PzU3HC5i.js";import{M as O}from"./MusicItem-BfOV4gVI.js";const z={class:"home-page"},G={class:"header"},J={name:"Home"},P=Object.assign(J,{setup(Q){const _=$(),d=u(""),l=u([]),c=u(!1),n=u(!1),f=u(null),B=u(null),r=u(1),y=u(20),R=u(0),i=L(()=>_.currentMusic),V=L(()=>i.value?l.value.some(o=>o.id===i.value.id):!1),b=()=>{i.value&&j(()=>{const o=document.querySelectorAll(".music-item");let e=null;if(o.forEach(a=>{var s;((s=a.querySelector(".name"))==null?void 0:s.textContent)===i.value.name&&(e=a)}),e&&f.value){const a=f.value.getBoundingClientRect(),s=e.getBoundingClientRect(),t=f.value.scrollTop,p=s.top-a.top+t-100;f.value.scrollTo({top:p,behavior:"smooth"}),v("已定位到当前播放")}else v("当前播放的歌曲不在列表中")})},w=async()=>{var o,e;try{console.log(`开始加载音乐列表... 第${r.value}页`),c.value=!0;const a=await D({page:r.value,limit:y.value,keyword:d.value});console.log("音乐列表响应:",a);const s=((o=a.data)==null?void 0:o.list)||a.data||[],t=((e=a.data)==null?void 0:e.total)||s.length;s.length>0?(r.value===1?(l.value=s,_.setMusicList(s)):l.value=[...l.value,...s],R.value=t,s.length<y.value||l.value.length>=t?(n.value=!0,console.log(`✅ 音乐列表加载完成，当前${l.value.length}首，共${t}首`)):(n.value=!1,r.value++,console.log(`✅ 音乐列表加载成功，当前${l.value.length}首，共${t}首，准备加载第${r.value}页`))):(r.value===1&&(console.warn("⚠️ 暂无音乐数据"),v("暂无音乐")),n.value=!0)}catch(a){console.error("❌ 加载音乐列表失败:",a),console.error("错误详情:",a.response||a.message),v("加载失败，请稍后重试")}finally{c.value=!1}},M=async()=>{if(r.value=1,l.value=[],n.value=!1,!d.value.trim()){await w();return}try{c.value=!0;const o=await A(d.value);o.data&&o.data.length>0?(l.value=o.data,n.value=!0):(l.value=[],v("未找到相关音乐"),n.value=!0)}catch(o){console.error("搜索失败:",o),v("搜索失败，请稍后重试"),n.value=!0}finally{c.value=!1}},S=()=>{if(console.log("onLoad 触发",{page:r.value,loading:c.value,finished:n.value,listLength:l.value.length}),n.value){console.log("已加载完成，跳过");return}w()};return N(()=>{console.log("=== Home.vue 已挂载 ===")}),(o,e)=>{const a=x("van-search"),s=x("van-list");return g(),h("div",z,[m("div",G,[e[2]||(e[2]=m("h1",{class:"title"},[m("i",{class:"fas fa-music"}),H(" 音乐库 ")],-1)),C(a,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),placeholder:"搜索歌曲、歌手",shape:"round",background:"transparent",onSearch:M,onKeyup:I(M,["enter"])},null,8,["modelValue"])]),m("div",{class:"content",ref_key:"contentRef",ref:f},[C(s,{loading:c.value,"onUpdate:loading":e[1]||(e[1]=t=>c.value=t),finished:n.value,"finished-text":"没有更多了",onLoad:S},{default:K(()=>[(g(!0),h(q,null,F(l.value,t=>(g(),U(O,{key:t.id,music:t,playlist:l.value,ref_for:!0,ref:p=>{var k;t.id===((k=i.value)==null?void 0:k.id)&&(B.value=p)}},null,8,["music","playlist"]))),128))]),_:1},8,["loading","finished"])],512),i.value&&V.value?(g(),h("div",{key:0,class:"locate-btn",onClick:b},[...e[3]||(e[3]=[m("i",{class:"fas fa-location-arrow"},null,-1)])])):E("",!0)])}}}),Y=T(P,[["__scopeId","data-v-487cb197"]]);export{Y as default};
