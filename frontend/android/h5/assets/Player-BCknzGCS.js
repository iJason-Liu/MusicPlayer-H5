import{C as Z,_ as ye,u as he,c as f,r as n,o as pe,p as b,a as m,b as s,e as j,q as E,t as G,v as J,x as y,y as h,z as K,A as Q,d as ge,F as X,j as Y,g as _e,M as ke,s as $,n as z,i as p}from"./index-PzU3HC5i.js";const xe=async()=>{if(Z.isNativePlatform())try{console.log("Background mode enabled")}catch(T){console.log("Background mode not available:",T)}},we=async T=>{if(Z.isNativePlatform())try{console.log("Media session not installed yet")}catch(a){console.log("Media session not available:",a)}},Me={class:"player-page"},Se={class:"player-content"},Ce={class:"top-bar"},Le={class:"song-info"},be={class:"content-box"},Te={class:"cover-wrapper"},Pe=["src"],Fe={class:"lyric-preview"},Ne={key:0,class:"lyric-line"},Ve=["data-index"],Ae={key:1,class:"no-lyric"},Ie={class:"progress-container"},$e={class:"time"},ze={class:"time"},Be={class:"controls"},De={name:"Player"},Re=Object.assign(De,{setup(T){const a=he(),l=f(()=>a.currentMusic),B=f(()=>a.isPlaying),D=f(()=>a.currentTime),x=f(()=>a.duration),ee=f(()=>a.playMode),R=f(()=>l.value?a.isFavorite(l.value.id):!1),k=n(0),c=n([]),w=n(!1),P=n(0),M=n(!1),i=n(0),S=n(!0),F=n(null),N=n(null),V=n(null),O=n(!1),q=n(!1),A=f({get:()=>a.showActionSheet,set:e=>a.showActionSheet=e});pe(()=>{xe()});const te=e=>{if(!e)return{lyrics:[],isLrc:!1};const d=e.replace(/\\n/g,`
`).split(`
`),g=/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)/;if(d.some(r=>g.test(r))){const r=[];return d.forEach(v=>{const o=v.match(g);if(o){const L=parseInt(o[1],10),u=parseInt(o[2],10),_=parseInt(o[3],10),I=o[4].trim();if(I&&I.length>0){const me=L*60+u+_/(o[3].length===2?100:1e3);r.push({time:me,text:I})}}}),r.sort((v,o)=>v.time-o.time),{lyrics:r,isLrc:!0}}else return{lyrics:d.filter(v=>v.trim()).map((v,o)=>({time:o,text:v.trim()})),isLrc:!1}},se=e=>{if(!(!S.value||c.value.length===0)){for(let t=c.value.length-1;t>=0;t--)if(e>=c.value[t].time){i.value!==t&&(i.value=t,H());return}i.value!==-1&&(i.value=-1)}},H=()=>{z(()=>{if(!F.value)return;const e=F.value,t=e.querySelector(".lyric-line.active");if(t){const d=e.clientHeight,g=t.offsetTop,C=t.clientHeight,r=g-d/2+C/2;e.scrollTo({top:r,behavior:"smooth"})}})};b(D,e=>{!w.value&&x.value>0&&(k.value=e/x.value*100),se(e)}),b(()=>{var e;return(e=l.value)==null?void 0:e.lyric},e=>{if(e)try{const t=te(e);c.value=t.lyrics,S.value=t.isLrc,i.value=0}catch(t){console.error("歌词解析错误:",t),c.value=[],S.value=!0,i.value=0}else c.value=[],S.value=!0,i.value=0},{immediate:!0}),b(()=>l.value,()=>{z(()=>{ae()})},{immediate:!0}),b(l,e=>{e&&we()});const ae=()=>{if(N.value){const e=N.value,t=e.querySelector(".text-content");t&&(O.value=t.scrollWidth>e.clientWidth)}if(V.value){const e=V.value,t=e.querySelector(".text-content");t&&(q.value=t.scrollWidth>e.clientWidth)}},W=e=>{const t=Math.floor(e/60),d=Math.floor(e%60);return`${t}:${d.toString().padStart(2,"0")}`},le=f(()=>({loop:"fa-repeat",random:"fa-random",single:"fa-redo"})[ee.value]),oe=()=>a.togglePlay(),ne=()=>a.playNext(),ce=()=>a.playPrev(),ie=()=>{w.value=!0,P.value=k.value},re=e=>{w.value&&(P.value=e,k.value=e)},ue=e=>{w.value=!1;const t=e/100*x.value;a.seek(t),k.value=e},ve=()=>{const e=a.togglePlayMode();$({loop:"列表循环",random:"随机播放",single:"单曲循环"}[e])},de=()=>{if(l.value){const e=a.toggleFavorite(l.value);$(e?"已添加到我的喜欢":"已取消喜欢")}},U=()=>{var e;(e=l.value)!=null&&e.lyric&&(M.value=!M.value,M.value&&z(()=>H()))},fe=()=>{if(!l.value){$("当前没有播放歌曲");return}A.value=!0};return(e,t)=>{var g,C,r,v,o,L;const d=_e("van-slider");return p(),m("div",Me,[s("div",{class:"background",style:E({backgroundImage:`url(${G(J)((g=l.value)==null?void 0:g.cover)})`})},null,4),s("div",Se,[s("div",Ce,[s("i",{class:"fas fa-chevron-down",onClick:t[0]||(t[0]=u=>e.$router.back())}),s("div",Le,[s("div",{class:"name",ref_key:"nameRef",ref:N},[s("span",{class:y(["text-content",{"scroll-text":O.value}])},h(((C=l.value)==null?void 0:C.name)||"暂无播放"),3)],512),s("div",{class:"artist",ref_key:"artistRef",ref:V},[s("span",{class:y(["text-content",{"scroll-text":q.value}])},h(((r=l.value)==null?void 0:r.artist)||""),3)],512)]),s("i",{class:"fas fa-ellipsis-v",onClick:fe})]),s("div",be,[K(s("div",{class:"cover-area",onClick:U},[s("div",Te,[s("img",{src:G(J)((v=l.value)==null?void 0:v.cover),class:y(["cover rotating",{paused:!B.value}])},null,10,Pe)]),s("div",Fe,[(p(!0),m(X,null,Y(c.value.slice(Math.max(0,i.value-1),i.value+2),(u,_)=>(p(),m("div",{key:`preview-${_}`,class:y(["lyric-line",{active:c.value[i.value]===u}])},h(u.text),3))),128)),c.value.length===0?(p(),m("div",Ne,h((o=l.value)!=null&&o.lyric?"歌词加载中...":"暂无歌词"),1)):ge("",!0)])],512),[[Q,!M.value]]),K(s("div",{class:"lyric-full",onClick:U},[c.value.length>0?(p(),m("div",{key:0,class:"lyric-scroll",ref_key:"lyricScrollRef",ref:F},[(p(!0),m(X,null,Y(c.value,(u,_)=>(p(),m("div",{key:`lyric-${_}`,class:y(["lyric-line",{active:i.value===_,"plain-text":!S.value}]),"data-index":_},h(u.text),11,Ve))),128))],512)):(p(),m("div",Ae,h((L=l.value)!=null&&L.lyric?"歌词加载中...":"暂无歌词"),1))],512),[[Q,M.value]])]),s("div",Ie,[s("span",$e,h(W(w.value?P.value/100*x.value:D.value)),1),j(d,{modelValue:k.value,"onUpdate:modelValue":[t[1]||(t[1]=u=>k.value=u),re],onChange:ue,onDragStart:ie,"bar-height":4,"button-size":16,"active-color":"#fff","inactive-color":"rgba(255,255,255,0.3)"},null,8,["modelValue"]),s("span",ze,h(W(x.value)),1)]),s("div",Be,[s("i",{class:y(["fas control-icon",le.value]),onClick:ve},null,2),s("i",{class:"fas fa-step-backward control-icon",onClick:ce}),s("i",{class:y(["fas control-icon play-btn",B.value?"fa-pause-circle":"fa-play-circle"]),onClick:oe},null,2),s("i",{class:"fas fa-step-forward control-icon",onClick:ne}),s("i",{class:y(["fas control-icon",(R.value,"fa-heart")]),style:E({color:R.value?"#ff4757":"#fff"}),onClick:de},null,6)])]),j(ke,{show:A.value,"onUpdate:show":t[2]||(t[2]=u=>A.value=u),music:l.value},null,8,["show","music"])])}}}),qe=ye(Re,[["__scopeId","data-v-91ba8cad"]]);export{qe as default};
