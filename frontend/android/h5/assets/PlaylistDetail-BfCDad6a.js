import{_ as K,u as O,r as i,H as W,a as r,b as s,d as G,e as u,t as k,v as _,y as v,h as w,g as C,F as Q,j as X,E as Y,B as Z,i as c,f as F,q as ee,K as se,s as n,J as M,S as le,O as ae,T as te,R as oe}from"./index-PzU3HC5i.js";const ne={class:"playlist-detail-page"},ie={class:"header"},re={key:0,class:"playlist-info"},ce={class:"cover"},de=["src"],ue={class:"info"},ve={class:"name"},pe={class:"desc"},fe={class:"meta"},me={class:"action-bar"},ye={key:1,class:"empty"},_e={key:2,class:"music-list"},he=["onClick"],ge={class:"index"},ke=["src"],we={class:"info"},Ce={class:"name"},be={class:"artist"},xe=["onClick"],Pe=["onClick"],De={class:"edit-popup"},Ee={class:"popup-header"},Fe={class:"popup-content"},Ve={class:"cover-field"},$e={class:"field-value"},Se=["src"],Ue={class:"popup-actions"},Be='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"%3E%3Crect fill="%23667eea" width="200" height="200"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" font-size="80" fill="white"%3E♪%3C/text%3E%3C/svg%3E',Me={__name:"PlaylistDetail",setup(Re){const b=Y(),h=Z(),p=O(),t=i(null),d=i([]),x=i(!1),g=i(!1),f=i(!1),o=i({name:"",description:"",cover:""}),V=i(null),y=i(""),P=i(null),R=[{name:"编辑歌单",value:"edit"},{name:"删除歌单",value:"delete",color:"#ee0a24"}],D=async()=>{try{x.value=!0;const l=await te(h.params.id);t.value=l.data,d.value=l.data.music_list||[]}catch(l){console.error("加载歌单详情失败:",l),n("加载失败")}finally{x.value=!1}},A=()=>{if(d.value.length===0){n("歌单还没有歌曲");return}p.setPlaylist(d.value),p.playMusic(d.value[0],0),b.push("/player")},N=(l,e)=>{p.setPlaylist(d.value),p.playMusic(l,e),b.push("/player")},z=l=>p.isFavorite(l),I=l=>{const e=p.toggleFavorite(l);n(e?"已添加到我的喜欢":"已取消喜欢")},L=async l=>{try{await M({title:"确认移除",message:`确定要从歌单中移除"${l.name}"吗？`}),await le(h.params.id,l.id),n("移除成功"),D()}catch(e){e!=="cancel"&&(console.error("移除失败:",e),n("移除失败"))}},T=async l=>{if(g.value=!1,l.value==="edit")q();else if(l.value==="delete")try{await M({title:"确认删除",message:`确定要删除歌单"${t.value.name}"吗？`}),await oe(h.params.id),n("删除成功"),b.back()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),n("删除失败"))}},q=()=>{const l=t.value.cover?_(t.value.cover):"";o.value={name:t.value.name,description:t.value.description||"",cover:l},y.value="",P.value=null,f.value=!0},$=()=>{var l;(l=V.value)==null||l.click()},j=l=>{const e=l.target.files[0];if(!e)return;if(!e.type.startsWith("image/")){n("请选择图片文件");return}if(e.size>5*1024*1024){n("图片大小不能超过5MB");return}P.value=e;const m=new FileReader;m.onload=E=>{y.value=E.target.result},m.readAsDataURL(e)},H=async()=>{if(!o.value.name.trim()){n("请输入歌单名称");return}try{let l=o.value.cover;P.value&&(l=y.value),await ae({id:h.params.id,name:o.value.name,description:o.value.description,cover:l}),n("更新成功"),f.value=!1,D()}catch(l){console.error("更新失败:",l),n("更新失败")}};return W(()=>{D()}),(l,e)=>{const m=C("van-button"),E=C("van-action-sheet"),S=C("van-field"),J=C("van-popup");return c(),r("div",ne,[s("div",ie,[s("i",{class:"fas fa-chevron-left back-btn",onClick:e[0]||(e[0]=a=>l.$router.back())}),e[9]||(e[9]=s("h1",{class:"title"},"歌单详情",-1)),s("i",{class:"fas fa-ellipsis-v more-btn",onClick:e[1]||(e[1]=a=>g.value=!0)})]),t.value?(c(),r("div",re,[s("div",ce,[s("img",{src:k(_)(t.value.cover)||Be},null,8,de)]),s("div",ue,[s("h2",ve,v(t.value.name),1),s("p",pe,v(t.value.description||"暂无描述"),1),s("div",fe,[s("span",null,v(t.value.music_count||0)+"首",1),e[10]||(e[10]=s("span",null,"·",-1)),s("span",null,"播放"+v(t.value.play_count||0)+"次",1)])])])):G("",!0),s("div",me,[u(m,{type:"primary",block:"",onClick:A},{default:w(()=>[...e[11]||(e[11]=[s("i",{class:"fas fa-play"},null,-1),F(" 播放全部 ",-1)])]),_:1})]),d.value.length===0&&!x.value?(c(),r("div",ye,[...e[12]||(e[12]=[s("i",{class:"fas fa-music"},null,-1),s("p",null,"歌单还没有歌曲",-1)])])):(c(),r("div",_e,[(c(!0),r(Q,null,X(d.value,(a,U)=>(c(),r("div",{key:a.id,class:"music-item",onClick:B=>N(a,U)},[s("div",ge,v(U+1),1),s("img",{src:k(_)(a.cover),class:"cover"},null,8,ke),s("div",we,[s("div",Ce,v(a.name),1),s("div",be,v(a.artist),1)]),s("div",{class:"actions",onClick:e[2]||(e[2]=se(()=>{},["stop"]))},[s("i",{class:"fas fa-heart action-icon",style:ee({color:z(a.id)?"#ff4757":"rgba(255,255,255,0.6)"}),onClick:B=>I(a)},null,12,xe),s("i",{class:"fas fa-trash action-icon",onClick:B=>L(a)},null,8,Pe)])],8,he))),128))])),u(E,{show:g.value,"onUpdate:show":e[3]||(e[3]=a=>g.value=a),actions:R,"cancel-text":"取消",onSelect:T},null,8,["show"]),u(J,{show:f.value,"onUpdate:show":e[8]||(e[8]=a=>f.value=a),position:"bottom",round:"",style:{padding:"20px"}},{default:w(()=>[s("div",De,[s("div",Ee,[e[13]||(e[13]=s("h3",null,"编辑歌单",-1)),s("i",{class:"fas fa-times",onClick:e[4]||(e[4]=a=>f.value=!1)})]),s("div",Fe,[s("div",Ve,[e[16]||(e[16]=s("div",{class:"field-label"},"歌单封面",-1)),s("div",$e,[o.value.cover||y.value?(c(),r("div",{key:0,class:"cover-preview",onClick:$},[s("img",{src:o.value.cover?k(_)(o.value.cover):k(_)(y.value)},null,8,Se),e[14]||(e[14]=s("div",{class:"cover-overlay"},[s("i",{class:"fas fa-camera"}),s("span",null,"更换封面")],-1))])):(c(),r("div",{key:1,class:"upload-btn",onClick:$},[...e[15]||(e[15]=[s("i",{class:"fas fa-plus"},null,-1),s("span",null,"上传封面",-1)])])),s("input",{ref_key:"fileInput",ref:V,type:"file",accept:"image/*",onChange:j,style:{display:"none"}},null,544)])]),u(S,{modelValue:o.value.name,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.name=a),label:"歌单名称",placeholder:"请输入歌单名称",required:"",clearable:""},null,8,["modelValue"]),u(S,{modelValue:o.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.description=a),label:"描述",type:"textarea",placeholder:"请输入歌单描述（可选）",rows:"3",maxlength:"200","show-word-limit":"",clearable:""},null,8,["modelValue"])]),s("div",Ue,[u(m,{block:"",onClick:e[7]||(e[7]=a=>f.value=!1)},{default:w(()=>[...e[17]||(e[17]=[F("取消",-1)])]),_:1}),u(m,{type:"primary",block:"",onClick:H},{default:w(()=>[...e[18]||(e[18]=[F("确定",-1)])]),_:1})])])]),_:1},8,["show"])])}}},Ne=K(Me,[["__scopeId","data-v-8d61dc9e"]]);export{Ne as default};
