import{_ as $,u as B,c as w,r as g,H as j,a as u,b as t,e as z,z as H,y as p,x as k,h as J,g as Q,A as R,s as _,J as U,n as q,i as d,d as D,F as G,j as K,t as W,v as X,N as Y}from"./index-PzU3HC5i.js";const Z={class:"playlist-page"},ee={class:"header"},ae={class:"title"},te={key:0,class:"header-actions"},le={key:1,class:"placeholder"},se={key:0,class:"empty"},oe={key:1,class:"edit-tip"},ne=["draggable","onDragstart","onDragover","onDrop"],ie={key:0,class:"fas fa-grip-vertical drag-handle"},re=["onClick"],ce={class:"index"},ue=["src"],de={class:"info"},ve={class:"name"},fe={class:"artist"},ge=["onClick"],he=["title"],_e={name:"Playlist"},ye=Object.assign(_e,{setup(pe){const i=B(),r=w(()=>i.playlist),c=w(()=>i.currentMusic),C=g(null),m=g(!1),P=g(!0),I=()=>{m.value=!1,P.value=!0},l=g(!1),v=g(null),h=g(null),M=(a,e)=>{i.playMusic(a,e)},S=a=>{i.removeFromPlaylist(a),_("已移除")},E=()=>{U({title:"清空播放列表",message:"确定要清空播放列表吗？"}).then(()=>{i.setPlaylist([]),_("已清空")}).catch(()=>{})},A=async()=>{try{const a=await Y();a.data&&Array.isArray(a.data)&&i.setPlaylist(a.data)}catch(a){console.error("加载播放队列失败:",a);const e=localStorage.getItem("playlist");if(e)try{i.setPlaylist(JSON.parse(e))}catch(s){console.error("解析播放列表失败:",s)}}},L=()=>{if(!c.value){_("当前没有播放歌曲");return}q(()=>{const a=document.querySelectorAll(".playlist-item");let e=null;a.forEach(s=>{s.classList.contains("active")&&(e=s)}),e&&C.value&&(e.scrollIntoView({behavior:"smooth",block:"center"}),_("已定位到当前播放"))})},T=()=>{l.value=!l.value,l.value||_("已保存顺序")},x=(a,e)=>{v.value=a,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",e.target.innerHTML),e.target.style.opacity="0.5"},N=a=>{a.target.style.opacity="1",v.value=null,h.value=null},F=(a,e)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",h.value=a},O=()=>{h.value=null},V=(a,e)=>{if(e.preventDefault(),e.stopPropagation(),v.value===null||v.value===a)return;const s=[...r.value],y=s[v.value];if(s.splice(v.value,1),s.splice(a,0,y),i.setPlaylist(s),c.value){const o=s.findIndex(n=>n.id===c.value.id);o>=0&&(i.currentIndex.value=o)}h.value=null};return j(()=>{A(),l.value=!1,console.log("播放列表页面激活"),console.log("当前播放:",c.value),console.log("播放列表长度:",r.value.length),console.log("编辑模式:",l.value),console.log("定位按钮应该显示:",!!(c.value&&r.value.length>0&&!l.value))}),(a,e)=>{var y;const s=Q("van-list");return d(),u("div",Z,[t("div",ee,[t("i",{class:"fas fa-chevron-left back-btn",onClick:e[0]||(e[0]=o=>a.$router.back())}),t("h1",ae,"播放列表 ("+p(r.value.length)+")",1),r.value.length>0?(d(),u("div",te,[t("i",{class:k(["fas action-btn",l.value?"fa-check":"fa-edit"]),onClick:T},null,2),t("i",{class:"fas fa-trash action-btn",onClick:E})])):(d(),u("div",le))]),z(s,{loading:m.value,"onUpdate:loading":e[1]||(e[1]=o=>m.value=o),finished:P.value,"finished-text":"没有更多了",onLoad:I,class:"content",ref_key:"contentRef",ref:C},{default:J(()=>[r.value.length===0?(d(),u("div",se,[...e[2]||(e[2]=[t("i",{class:"fas fa-list-ul"},null,-1),t("p",null,"播放列表为空",-1)])])):D("",!0),l.value&&r.value.length>0?(d(),u("div",oe,[...e[3]||(e[3]=[t("i",{class:"fas fa-info-circle"},null,-1),t("span",null,"长按拖动可调整播放顺序",-1)])])):D("",!0),(d(!0),u(G,null,K(r.value,(o,n)=>{var b;return d(),u("div",{key:o.id,class:k(["playlist-item",{active:((b=c.value)==null?void 0:b.id)===o.id,"edit-mode":l.value,dragging:v.value===n,"drag-over":h.value===n}]),draggable:l.value,onDragstart:f=>x(n,f),onDragend:N,onDragover:f=>F(n,f),onDragleave:O,onDrop:f=>V(n,f)},[l.value?(d(),u("i",ie)):D("",!0),t("div",{class:"left",onClick:f=>!l.value&&M(o,n)},[t("div",ce,p(n+1),1),t("img",{src:W(X)(o.cover),class:"cover"},null,8,ue),t("div",de,[t("div",ve,p(o.name),1),t("div",fe,p(o.artist),1)])],8,re),t("i",{class:k(["fas remove-btn",l.value?"fa-minus-circle":"fa-times"]),onClick:f=>S(n)},null,10,ge)],42,ne)}),128))]),_:1},8,["loading","finished"]),H(t("div",{class:"locate-btn",onClick:L,title:"定位到: "+(((y=c.value)==null?void 0:y.name)||"")},[...e[4]||(e[4]=[t("i",{class:"fas fa-location-arrow"},null,-1)])],8,he),[[R,c.value&&r.value.length>0&&!l.value]])])}}}),ke=$(ye,[["__scopeId","data-v-38fe4880"]]);export{ke as default};
