import{_ as Q,r as o,H as W,a as i,b as s,e as f,y as v,x as F,h as C,g as b,F as M,j as S,E as G,i as u,f as x,t as $,v as y,K as X,s as r,O as Y,P as Z,Q as ee,J as se,R as le}from"./index-PzU3HC5i.js";const te={class:"my-playlists-page"},ae={class:"header"},oe={class:"stats-bar"},ne={class:"stat-item"},ie={class:"value"},ue={class:"view-toggle"},ve={key:0,class:"empty"},re={key:1,class:"grid-view"},de=["onClick"],ce={class:"cover"},pe=["src"],fe={class:"play-count"},me={class:"info"},_e={class:"name"},ge={class:"count"},ye={key:2,class:"list-view"},we=["onClick"],he={class:"cover"},ke=["src"],Ce={class:"info"},be={class:"name"},xe={class:"desc"},$e={class:"meta"},Pe=["onClick"],Ve={class:"create-popup"},De={class:"popup-header"},Ee={class:"popup-content"},Ue={class:"cover-field"},Ae={class:"field-value"},Be=["src"],Fe={class:"popup-actions"},R='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"%3E%3Crect fill="%23667eea" width="200" height="200"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" font-size="80" fill="white"%3E♪%3C/text%3E%3C/svg%3E',Me={__name:"MyPlaylists",setup(Se){const z=G(),w=o([]),D=o(0),P=o(!1),_=o("grid"),d=o(!1),h=o(!1),m=o(null),c=o(null),a=o({name:"",description:"",cover:""}),E=o(null),p=o(""),g=o(null),I=[{name:"编辑",value:"edit"},{name:"删除",value:"delete",color:"#ee0a24"}],V=async()=>{var t,e;try{P.value=!0;const n=await ee();w.value=((t=n.data)==null?void 0:t.list)||[],D.value=((e=n.data)==null?void 0:e.total)||0}catch(n){console.error("加载歌单失败:",n),r("加载失败")}finally{P.value=!1}},L=t=>{c.value=t,h.value=!0},N=t=>{h.value=!1,t.value==="edit"?j():t.value==="delete"&&H()},T=()=>{m.value=null,a.value={name:"",description:"",cover:""},p.value="",g.value=null,d.value=!0},j=()=>{m.value=c.value;const t=c.value.cover?y(c.value.cover):"";a.value={name:c.value.name,description:c.value.description||"",cover:t},p.value="",g.value=null,d.value=!0},U=()=>{var t;(t=E.value)==null||t.click()},q=t=>{const e=t.target.files[0];if(!e)return;if(!e.type.startsWith("image/")){r("请选择图片文件");return}if(e.size>5*1024*1024){r("图片大小不能超过5MB");return}g.value=e;const n=new FileReader;n.onload=k=>{p.value=k.target.result},n.readAsDataURL(e)},H=async()=>{try{await se({title:"确认删除",message:`确定要删除歌单"${c.value.name}"吗？`}),await le(c.value.id),r("删除成功"),V()}catch(t){t!=="cancel"&&(console.error("删除失败:",t),r("删除失败"))}},J=async()=>{if(!a.value.name.trim()){r("请输入歌单名称");return}try{let t=a.value.cover;g.value&&(t=p.value);const e={name:a.value.name,description:a.value.description,cover:t};m.value?(await Y({id:m.value.id,...e}),r("更新成功")):(await Z(e),r("创建成功")),d.value=!1,m.value=null,a.value={name:"",description:"",cover:""},p.value="",g.value=null,V()}catch(t){console.error("保存失败:",t),r("保存失败")}},A=t=>{z.push(`/playlist/${t}`)};return W(()=>{V()}),(t,e)=>{const n=b("van-button"),k=b("van-field"),K=b("van-popup"),O=b("van-action-sheet");return u(),i("div",te,[s("div",ae,[s("i",{class:"fas fa-chevron-left back-btn",onClick:e[0]||(e[0]=l=>t.$router.back())}),e[11]||(e[11]=s("h1",{class:"title"},"我的歌单",-1)),s("i",{class:"fas fa-plus add-btn",onClick:T})]),s("div",oe,[s("div",ne,[e[12]||(e[12]=s("span",{class:"label"},"歌单总数",-1)),s("span",ie,v(D.value),1)]),s("div",ue,[s("i",{class:F(["fas fa-th",{active:_.value==="grid"}]),onClick:e[1]||(e[1]=l=>_.value="grid")},null,2),s("i",{class:F(["fas fa-list",{active:_.value==="list"}]),onClick:e[2]||(e[2]=l=>_.value="list")},null,2)])]),w.value.length===0&&!P.value?(u(),i("div",ve,[e[14]||(e[14]=s("i",{class:"fas fa-list-ul"},null,-1)),e[15]||(e[15]=s("p",null,"还没有创建歌单",-1)),f(n,{type:"primary",onClick:e[3]||(e[3]=l=>d.value=!0)},{default:C(()=>[...e[13]||(e[13]=[x("新建歌单",-1)])]),_:1})])):_.value==="grid"?(u(),i("div",re,[(u(!0),i(M,null,S(w.value,l=>(u(),i("div",{key:l.id,class:"playlist-card",onClick:B=>A(l.id)},[s("div",ce,[s("img",{src:$(y)(l.cover)||R},null,8,pe),s("div",fe,[e[16]||(e[16]=s("i",{class:"fas fa-play"},null,-1)),x(" "+v(l.play_count||0),1)])]),s("div",me,[s("div",_e,v(l.name),1),s("div",ge,v(l.music_count||0)+"首",1)])],8,de))),128))])):(u(),i("div",ye,[(u(!0),i(M,null,S(w.value,l=>(u(),i("div",{key:l.id,class:"playlist-item",onClick:B=>A(l.id)},[s("div",he,[s("img",{src:$(y)(l.cover)||R},null,8,ke)]),s("div",Ce,[s("div",be,v(l.name),1),s("div",xe,v(l.description||"暂无描述"),1),s("div",$e,[s("span",null,v(l.music_count||0)+"首",1),e[17]||(e[17]=s("span",null,"·",-1)),s("span",null,"播放"+v(l.play_count||0)+"次",1)])]),s("div",{class:"actions",onClick:e[4]||(e[4]=X(()=>{},["stop"]))},[s("i",{class:"fas fa-ellipsis-v",onClick:B=>L(l)},null,8,Pe)])],8,we))),128))])),f(K,{show:d.value,"onUpdate:show":e[9]||(e[9]=l=>d.value=l),position:"bottom",round:"",style:{padding:"20px"}},{default:C(()=>[s("div",Ve,[s("div",De,[s("h3",null,v(m.value?"编辑歌单":"新建歌单"),1),s("i",{class:"fas fa-times",onClick:e[5]||(e[5]=l=>d.value=!1)})]),s("div",Ee,[s("div",Ue,[e[20]||(e[20]=s("div",{class:"field-label"},"歌单封面",-1)),s("div",Ae,[a.value.cover||p.value?(u(),i("div",{key:0,class:"cover-preview",onClick:U},[s("img",{src:a.value.cover?$(y)(a.value.cover):$(y)(p.value)},null,8,Be),e[18]||(e[18]=s("div",{class:"cover-overlay"},[s("i",{class:"fas fa-camera"})],-1))])):(u(),i("div",{key:1,class:"upload-btn",onClick:U},[...e[19]||(e[19]=[s("i",{class:"fas fa-plus"},null,-1),s("span",null,"上传封面",-1)])])),s("input",{ref_key:"fileInput",ref:E,type:"file",accept:"image/*",onChange:q,style:{display:"none"}},null,544)])]),f(k,{modelValue:a.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.name=l),label:"歌单名称",placeholder:"请输入歌单名称",required:"",clearable:""},null,8,["modelValue"]),f(k,{modelValue:a.value.description,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.description=l),label:"描述",type:"textarea",placeholder:"请输入歌单描述（可选）",rows:"3",maxlength:"200","show-word-limit":"",clearable:""},null,8,["modelValue"])]),s("div",Fe,[f(n,{block:"",onClick:e[8]||(e[8]=l=>d.value=!1)},{default:C(()=>[...e[21]||(e[21]=[x("取消",-1)])]),_:1}),f(n,{type:"primary",block:"",onClick:J},{default:C(()=>[...e[22]||(e[22]=[x("确定",-1)])]),_:1})])])]),_:1},8,["show"]),f(O,{show:h.value,"onUpdate:show":e[10]||(e[10]=l=>h.value=l),actions:I,"cancel-text":"取消",onSelect:N},null,8,["show"])])}}},ze=Q(Me,[["__scopeId","data-v-724691f9"]]);export{ze as default};
