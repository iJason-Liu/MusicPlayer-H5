import{_ as b,u as H,c as L,r as d,H as D,a as u,b as s,e as M,y as _,h as S,g as B,i as h,d as k,F as N,j as P,t as V,v as j,K as C,q as z,x as U,s as f,J as q,L as A}from"./index-PzU3HC5i.js";const E={class:"history-page"},I={class:"header"},J={class:"title"},K={key:0,class:"empty"},O=["onClick"],T=["src"],G={class:"info"},Q={class:"name"},R={class:"artist"},W={class:"stats"},X={class:"play-count"},Y={key:0,class:"duration"},Z={class:"actions"},tt=["onClick"],et=["onClick"],st={name:"History"},at=Object.assign(st,{setup(ot){const n=H();L(()=>n.currentMusic);const o=d([]),v=d(!1),i=d(!1),r=d(1),y=d(20),g=d(0),m=async()=>{var a,e;try{v.value=!0,console.log(`加载播放历史第 ${r.value} 页`);const l=await A({page:r.value,limit:y.value}),t=((a=l.data)==null?void 0:a.list)||[],c=((e=l.data)==null?void 0:e.total)||0;g.value=c,t.length>0?(o.value=[...o.value,...t],console.log(`当前 ${o.value.length} 条，共 ${c} 条`),t.length<y.value||o.value.length>=c?(i.value=!0,console.log("✅ 播放历史加载完成")):(i.value=!1,r.value++,console.log(`准备加载第 ${r.value} 页`))):(r.value===1&&console.log("暂无播放历史"),i.value=!0)}catch(l){console.error("加载播放历史失败:",l),f("加载失败")}finally{v.value=!1}},x=async()=>{if(i.value){console.log("已加载完成，跳过");return}m()};D(()=>{r.value=1,i.value=!1,o.value=[]});const $=a=>{n.setPlaylist(o.value);const e=o.value.findIndex(l=>l.id===a.id);n.playMusic(a,e)},p=a=>n.isFavorite(a),w=a=>{const e=n.toggleFavorite(a);f(e?"已添加到我的喜欢":"已取消喜欢")},F=async a=>{try{await q({title:"确认删除",message:"确定要删除这条播放记录吗？"}),await n.removeFromHistory(a),o.value=o.value.filter(e=>e.id!==a),f("删除成功")}catch{}};return(a,e)=>{const l=B("van-list");return h(),u("div",E,[s("div",I,[s("i",{class:"fas fa-chevron-left back-btn",onClick:e[0]||(e[0]=t=>a.$router.back())}),s("h1",J,"播放历史 ("+_(g.value)+")",1),e[2]||(e[2]=s("div",{class:"placeholder"},null,-1))]),M(l,{loading:v.value,"onUpdate:loading":e[1]||(e[1]=t=>v.value=t),finished:i.value,"finished-text":"没有更多了",onLoad:x,class:"content"},{default:S(()=>[o.value.length===0&&!v.value?(h(),u("div",K,[...e[3]||(e[3]=[s("i",{class:"fas fa-history"},null,-1),s("p",null,"暂无播放历史",-1)])])):k("",!0),(h(!0),u(N,null,P(o.value,t=>(h(),u("div",{key:"history-"+t.id,class:"history-item",onClick:c=>$(t)},[s("img",{src:V(j)(t.cover),class:"cover"},null,8,T),s("div",G,[s("div",Q,_(t.name),1),s("div",R,_(t.artist),1),s("div",W,[s("span",X,"播放 "+_(t.play_count||0)+" 次",1),t.total_duration_text?(h(),u("span",Y,"· "+_(t.total_duration_text),1)):k("",!0)])]),s("div",Z,[s("i",{class:U(["fas action-icon",(p(t.id),"fa-heart")]),style:z({color:p(t.id)?"#ff4757":"rgba(255,255,255,0.6)"}),onClick:C(c=>w(t),["stop"])},null,14,tt),s("i",{class:"fas fa-trash action-icon",onClick:C(c=>F(t.id),["stop"])},null,8,et)])],8,O))),128))]),_:1},8,["loading","finished"])])}}}),nt=b(at,[["__scopeId","data-v-2e51e649"]]);export{nt as default};
