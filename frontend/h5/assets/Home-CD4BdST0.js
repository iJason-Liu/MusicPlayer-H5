import{a as B,_ as E,u as P,r as l,o as S,c as g,b as d,d as h,e as U,f as _,w as b,F as H,g as I,h as f,i as N}from"./index-CIrrklg4.js";import{M as $}from"./MusicItem-Col63uAG.js";import{s as v}from"./function-call-9VrdCN6p.js";const y="https://diary.crayon.vip/api";console.log("API Base URL:",y);const p=B.create({baseURL:y,timeout:1e4});p.interceptors.response.use(a=>{const o=a.data;return o.code!==1?(console.error(o.msg||"Error"),Promise.reject(new Error(o.msg||"Error"))):o},a=>(console.error("请求错误："+a.message),Promise.reject(a)));const j=(a={})=>p.get("/music/list",{params:a}),C=a=>p.get("/music/search",{params:{keyword:a}}),F={class:"home-page"},R={class:"header"},T={class:"content"},q={__name:"Home",setup(a){const o=P(),c=l(""),s=l([]),r=l(!1),t=l(!1),n=l(1),w=l(20),L=l(0),m=async()=>{try{console.log(`开始加载音乐列表... 第${n.value}页`),r.value=!0;const e=await j({page:n.value,limit:w.value,keyword:c.value});console.log("音乐列表响应:",e),e.data&&e.data.list&&e.data.list.length>0?(n.value===1?(s.value=e.data.list,o.setMusicList(e.data.list),o.setPlaylist(e.data.list)):s.value=[...s.value,...e.data.list],L.value=e.data.total,s.value.length>=e.data.total&&(t.value=!0),console.log(`✅ 音乐列表加载成功，当前${s.value.length}首，共${e.data.total}首`)):(n.value===1&&(console.warn("⚠️ 暂无音乐数据"),v("暂无音乐")),t.value=!0)}catch(e){console.error("❌ 加载音乐列表失败:",e),console.error("错误详情:",e.response||e.message),v("加载失败，请稍后重试"),t.value=!0}finally{r.value=!1}},M=async()=>{if(n.value=1,s.value=[],t.value=!1,!c.value.trim()){await m();return}try{r.value=!0;const e=await C(c.value);e.data&&e.data.length>0?(s.value=e.data,t.value=!0):(s.value=[],v("未找到相关音乐"),t.value=!0)}catch(e){console.error("搜索失败:",e),v("搜索失败，请稍后重试"),t.value=!0}finally{r.value=!1}},x=()=>{t.value||(n.value++,m())};return S(()=>{console.log("=== Home.vue 已挂载 ==="),m()}),(e,u)=>{const k=_("van-search"),V=_("van-list");return f(),g("div",F,[d("div",R,[u[2]||(u[2]=d("h1",{class:"title"},[d("i",{class:"fas fa-music"}),U(" 音乐库 ")],-1)),h(k,{modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=i=>c.value=i),placeholder:"搜索歌曲、歌手",shape:"round",background:"transparent",onSearch:M},null,8,["modelValue"])]),d("div",T,[h(V,{loading:r.value,"onUpdate:loading":u[1]||(u[1]=i=>r.value=i),finished:t.value,"finished-text":"没有更多了",onLoad:x},{default:b(()=>[(f(!0),g(H,null,I(s.value,i=>(f(),N($,{key:i.id,music:i},null,8,["music"]))),128))]),_:1},8,["loading","finished"])])])}}},D=E(q,[["__scopeId","data-v-f5f39daa"]]);export{D as default};
