import{_ as T,u as N,r as u,c as k,o as E,a as _,b as m,d as H,e as w,f as I,g as C,w as $,h as j,s as v,n as q,i as p,F,j as U,k as A,l as D}from"./index-BgLcfbKB.js";import{M as K}from"./MusicItem-kF4gKZNK.js";const O={class:"home-page"},z={class:"header"},G={name:"Home"},J=Object.assign(G,{setup(P){const y=N(),d=u(""),t=u([]),r=u(!1),n=u(!1),f=u(null),x=u(null),c=u(1),L=u(20),B=u(0),i=k(()=>y.currentMusic),R=k(()=>i.value?t.value.some(l=>l.id===i.value.id):!1),V=()=>{i.value&&q(()=>{const l=document.querySelectorAll(".music-item");let e=null;if(l.forEach(a=>{var o;((o=a.querySelector(".name"))==null?void 0:o.textContent)===i.value.name&&(e=a)}),e&&f.value){const a=f.value.getBoundingClientRect(),o=e.getBoundingClientRect(),s=f.value.scrollTop,h=o.top-a.top+s-100;f.value.scrollTo({top:h,behavior:"smooth"}),v("已定位到当前播放")}else v("当前播放的歌曲不在列表中")})},g=async()=>{var l,e;try{console.log(`开始加载音乐列表... 第${c.value}页`),r.value=!0;const a=await j({page:c.value,limit:L.value,keyword:d.value});console.log("音乐列表响应:",a);const o=((l=a.data)==null?void 0:l.list)||a.data||[],s=((e=a.data)==null?void 0:e.total)||o.length;o.length>0?(c.value===1?(t.value=o,y.setMusicList(o)):t.value=[...t.value,...o],B.value=s,t.value.length>=s&&(n.value=!0),console.log(`✅ 音乐列表加载成功，当前${t.value.length}首，共${s}首`)):(c.value===1&&(console.warn("⚠️ 暂无音乐数据"),v("暂无音乐")),n.value=!0)}catch(a){console.error("❌ 加载音乐列表失败:",a),console.error("错误详情:",a.response||a.message),v("加载失败，请稍后重试"),n.value=!0}finally{r.value=!1}},b=async()=>{if(c.value=1,t.value=[],n.value=!1,!d.value.trim()){await g();return}try{r.value=!0;const l=await D(d.value);l.data&&l.data.length>0?(t.value=l.data,n.value=!0):(t.value=[],v("未找到相关音乐"),n.value=!0)}catch(l){console.error("搜索失败:",l),v("搜索失败，请稍后重试"),n.value=!0}finally{r.value=!1}},S=()=>{c.value===1&&t.value.length===0?g():!n.value&&r.value&&(c.value++,g())};return E(()=>{console.log("=== Home.vue 已挂载 ==="),t.value.length===0&&g()}),(l,e)=>{const a=C("van-search"),o=C("van-list");return p(),_("div",O,[m("div",z,[e[2]||(e[2]=m("h1",{class:"title"},[m("i",{class:"fas fa-music"}),I(" 音乐库 ")],-1)),w(a,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),placeholder:"搜索歌曲、歌手",shape:"round",background:"transparent",onSearch:b},null,8,["modelValue"])]),m("div",{class:"content",ref_key:"contentRef",ref:f},[w(o,{loading:r.value,"onUpdate:loading":e[1]||(e[1]=s=>r.value=s),finished:n.value,"finished-text":"没有更多了",onLoad:S},{default:$(()=>[(p(!0),_(F,null,U(t.value,s=>(p(),A(K,{key:s.id,music:s,playlist:t.value,ref_for:!0,ref:h=>{var M;s.id===((M=i.value)==null?void 0:M.id)&&(x.value=h)}},null,8,["music","playlist"]))),128))]),_:1},8,["loading","finished"])],512),i.value&&R.value?(p(),_("div",{key:0,class:"locate-btn",onClick:V},[...e[3]||(e[3]=[m("i",{class:"fas fa-location-arrow"},null,-1)])])):H("",!0)])}}}),X=T(J,[["__scopeId","data-v-b23afcde"]]);export{X as default};
